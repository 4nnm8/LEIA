<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Configurer LÉIA</title>
    <link rel="stylesheet" href="leia.css" type="text/css" media="screen" />
  </head>
  <body class="conf">
    <table>
      <tr>
        <td><label for="mode">Choix du mode de lecture inclusive</label></td>
        <td>
          <select id="mode">
            <option value="0">Aucun - Désactivé</option>
            <option value="1">Mots lus aux deux genres</option>
            <option value="2">Mots lus au maculin uniquement</option>
            <option value="3">Mots lus au féminin uniquement</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><label for="pred">Dictionnaire de saisie prédictive écriture inclusive</td>
        </label>
        <td>
          <select id="pred">
            <option value="0">Désactivé</option>
            <option value="1">Activé</option>
          </select>
        </td>
      </tr>
      <tr>
        <td><label for="high">Surligner l"écriture inlusive</label></td>
        <td>
          <select id="high">
            <option value="0">Désactivé</option>
            <option value="1">Activé</option>
          </select>
          <br/><br/>
          <input type="color" id="bgColor" /> Couleur de fond&nbsp;<br/>
          <input type="color" id="txtColor" /> Couleur du texte<br/>
          <label for="fontWeight"><input type="checkbox" id="fontWeight" /> Gras</label>
          <label for="txtDeco"><input type="checkbox" id="txtDeco" /> Souligné</label><br/>
          <p class="ex"><b>Exemple :</b> imprimeur<span id="ex">·euse</span></p>
        </td>
      </tr>
    </table>
    <p><button id="launch">Appliquer les changements</button></p>
    <p>Panneau de configuration <kbd>Alt</kbd> <kbd>Shift</kbd> <kbd>C</kbd></p>
    <p>Insérer un point médian <kbd>;</kbd> <kbd>;</kbd></p>
    <script type="text/javascript">
      function addEvent(obj, evt, fn) { 
        if (obj.addEventListener) {
          obj.addEventListener(evt, fn, false);
          return true;
        } else if (obj.attachEvent) {
          return obj.attachEvent("on" + evt, fn);
        } else {
          evt = "on" + evt;
          if (typeof obj[evt] === "function") {
            fn = (function(f1, f2) {
              return function() {
                f1.apply(this, arguments);
                f2.apply(this, arguments);
              }
            })(obj[evt], fn);
          }
          obj[evt] = fn;
          return true;
        }
        return false;
      }
      function $(id) {
        return document.getElementById(id)
      }
      function get(m) {
        return localStorage.getItem(m)
      }
      function set(n){
        let vl = $(n).options[$(n).selectedIndex].value;
        localStorage.setItem(n,vl);
        GM.setValue(n,vl);
      }      
      function passCfg(){
        set("mode");
        set("pred");
        set("high");
        ($("fontWeight").checked == true) ? localStorage.setItem("fontWeight","bold") : localStorage.setItem("fontWeight","normal");
        ($("txtDeco").checked == true) ? localStorage.setItem("txtDeco","underline") : localStorage.setItem("txtDeco","none");
        localStorage.setItem("bgColor",$("bgColor").value);
        localStorage.setItem("txtColor",$("txtColor").value);
        //window.opener.location.reload();
        window.close();
      }
      $("mode").selectedIndex = get("mode") || 1;
      $("pred").selectedIndex = get("pred") || 1;
      $("high").selectedIndex = get("high") || 0;
      $("txtColor").value = get("txtColor");
      $("bgColor").value = get("bgColor");
      $("ex").style.textDecoration = get("txtDeco");
      $("ex").style.fontWeight = get("fontWeight");
      $("ex").style.backgroundColor = get("bgColor");
      $("ex").style.color = get("txtColor");
      (get("fontWeight") == "bold" ) ? $("fontWeight").checked = true : $("fontWeight").checked = false; 
      (get("txtDeco") == "underline" ) ? $("txtDeco").checked = true : $("txtDeco").checked = false;
      addEvent($("bgColor"), "change", function(e) {
        $("ex").style.backgroundColor = this.value
      });
      addEvent($("txtColor"), "change", function(e) {
        $("ex").style.color = this.value
      });
      addEvent($("fontWeight"), "change", function(e) {
        (this.checked == true) ? $("ex").style.fontWeight = "bold" : $("ex").style.fontWeight = "normal";
      });
      addEvent($("txtDeco"), "change", function(e) {
        (this.checked == true) ? $("ex").style.textDecoration = "underline" : $("ex").style.textDecoration = "none";
      });
      addEvent($("high"), "change", function(e) {
        if (this.selectedIndex == 1) {
          $("mode").selectedIndex = 0;
        }
      });
      addEvent($("mode"), "change", function(e) {
        if (this.selectedIndex !== 0) {
          $("high").selectedIndex = 0;
        }
      });
      addEvent($("launch"),"click",passCfg);
      addEvent(window,"beforeunload",passCfg);
    </script>
  </body>
</html>
